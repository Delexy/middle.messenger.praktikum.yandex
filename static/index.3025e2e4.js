function t(t){return function(t){return"object"==typeof t&&null!==t&&t.constructor===Object&&"[object Object]"===Object.prototype.toString.call(t)}(t)||function(t){return Array.isArray(t)}(t)}var e=function e(s){const n=[];for(const r in s)t(s[r])?Object.entries(s[r]).forEach((([s,i])=>{t(i)?n.push(`${r}[${s}]${e({"":i})}`):n.push(`${r}[${s}]=${i}`)})):n.push(`${r}=${s[r]}`);return n.join("&")};const s="GET",n="PUT",r="POST",i="DELETE";class a{constructor(t=""){this._baseUrl=t}get=(t,e={timeout:5e3})=>this.request(this._baseUrl+t,{...e,method:s},e.timeout);put=(t,e={timeout:5e3})=>this.request(this._baseUrl+t,{...e,method:n},e.timeout);post=(t,e={timeout:5e3})=>this.request(this._baseUrl+t,{...e,method:r},e.timeout);delete=(t,e={timeout:5e3})=>this.request(this._baseUrl+t,{...e,method:i},e.timeout);request=(t,n={method:s,data:""},r=5e3)=>new Promise(((i,a)=>{const{headers:o}=n;let{method:c,data:l}=n;c||(c=s);const u=new XMLHttpRequest;u.open(c,t),u.withCredentials=!0;const p=t=>{a({status:0,response:{reason:t.message}})};if(c===s&&l&&(l=e(l),t+=`?${l}`),o)for(const t in o)u.setRequestHeader(t,o[t]);u.onerror=p,u.onabort=p,u.ontimeout=()=>{a({status:0,response:"Timeout"})};const d=setTimeout((()=>{u.abort()}),r);u.onload=function(){try{i({status:u.status,response:JSON.parse(u.response)})}catch(t){i({status:u.status,response:u.response})}clearTimeout(d)},c!==s&&l?u.send(l):u.send()}))}class o{constructor(t){this.HTTPEntity=new a(`https://ya-praktikum.tech/api/v2${t||""}`)}}var c=class extends o{constructor(){super("/auth")}async getUser(){const{status:t,response:e}=await this.HTTPEntity.get("/user");return 200===t?e:null}logout(){return this.HTTPEntity.post("/logout")}};var l=function(t){var e,s="",n=t||{};return function(t){s=s+'<div class="auth-page"><div class="auth-page__content"> '+(null==(e=t)?"":e)+"</div></div>"}.call(this,"RegistrationForm"in n?n.RegistrationForm:"undefined"!=typeof RegistrationForm?RegistrationForm:void 0),s};var u=class{constructor(){this.listeners={}}on(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)}off(t,e){if(!this.listeners[t])throw new Error(`Нет события: ${t}`);this.listeners[t]=this.listeners[t].filter((t=>t!==e))}emit(t,...e){if(!this.listeners[t])throw new Error(`Нет события: ${t}`);this.listeners[t].forEach((function(t){t(...e)}))}};var p={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let d;const h=new Uint8Array(16);function f(){if(!d&&(d="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!d))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return d(h)}const g=[];for(let t=0;t<256;++t)g.push((t+256).toString(16).slice(1));function v(t,e=0){return(g[t[e+0]]+g[t[e+1]]+g[t[e+2]]+g[t[e+3]]+"-"+g[t[e+4]]+g[t[e+5]]+"-"+g[t[e+6]]+g[t[e+7]]+"-"+g[t[e+8]]+g[t[e+9]]+"-"+g[t[e+10]]+g[t[e+11]]+g[t[e+12]]+g[t[e+13]]+g[t[e+14]]+g[t[e+15]]).toLowerCase()}var m=function(t,e,s){if(p.randomUUID&&!e&&!t)return p.randomUUID();const n=(t=t||{}).random||(t.rng||f)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){s=s||0;for(let t=0;t<16;++t)e[s+t]=n[t];return e}return v(n)};function y(t){return function(t){return"object"==typeof t&&null!==t&&t.constructor===Object&&"[object Object]"===Object.prototype.toString.call(t)}(t)||function(t){return Array.isArray(t)}(t)}var b=function t(e,s){if(Object.keys(e).length!==Object.keys(s).length)return!1;for(const[n,r]of Object.entries(e)){const e=s[n];if(y(r)&&y(e)){if(t(r,e))continue;return!1}if(r!==e)return!1}return!0};let _;var w;(w=_||(_={})).INIT="init",w.FLOW_CDM="flow:component-did-mount",w.FLOW_CDU="flow:component-did-update",w.FLOW_CU="flow:component-updated",w.FLOW_RENDER="flow:render",w.FLOW_UM="flow:component-unmount";class M{constructor(t={}){const e=new u,{children:s,props:n}=this._getChildren(t);this.id=m(),this._element,this._meta={props:n},this.props=this._makePropsProxy(n),this.children=s,this.eventBus=()=>e,this._registerEvents(e),e.emit(_.INIT)}_registerEvents(t){t.on(_.INIT,this._init.bind(this)),t.on(_.FLOW_CDM,this._componentDidMount.bind(this)),t.on(_.FLOW_CDU,this._componentDidUpdate.bind(this)),t.on(_.FLOW_CU,this._componentUpdated.bind(this)),t.on(_.FLOW_RENDER,this._render.bind(this)),t.on(_.FLOW_UM,this._render.bind(this))}_addEvents(){const{events:t}=this.props;t&&Object.keys(t).forEach((e=>{this._element&&(Array.isArray(t[e])?t[e].forEach((t=>this._element.addEventListener(e,t))):this._element.addEventListener(e,t[e]))}))}_removeEvents(){const{events:t}=this.props;t&&Object.keys(t).forEach((e=>{this._element&&(Array.isArray(t[e])?t[e].forEach((t=>this._element.removeEventListener(e,t))):this._element.removeEventListener(e,t[e]))}))}_getChildren(t){const e={},s={};return Object.entries(t).forEach((([t,n])=>{Array.isArray(n)&&n[0]instanceof M||n instanceof M?e[t]=n:s[t]=n})),{children:e,props:s}}_init(){this.init(),this.eventBus().emit(_.FLOW_RENDER)}init(){}_componentDidMount(){this.componentDidMount(),Object.values(this.children).forEach((t=>{Array.isArray(t)?t.forEach((t=>t.dispatchComponentDidMount())):t.dispatchComponentDidMount()}))}componentDidMount(){}dispatchComponentDidMount(){this.eventBus().emit(_.FLOW_CDM)}_componentDidUpdate(t,e){this.componentDidUpdate(t,e)&&(this.eventBus().emit(_.FLOW_RENDER),this.eventBus().emit(_.FLOW_CU))}componentDidUpdate(t,e){return!b(t,e)}_componentUpdated(){this.componentUpdated()}componentUpdated(){}_componentBeforeUnmount(){this._removeEvents(),this.componentBeforeUnmount()}componentBeforeUnmount(){}setProps=t=>{t&&Object.assign(this.props,t)};get element(){return this._element}_render(){const t=this.render();this._removeEvents();const e=t.firstChild;this._element&&this._element.replaceWith(t),this._element=e,this._addEvents()}render(){return""}compile(t,e){const s={...e};Object.entries(this.children).forEach((([t,e])=>{Array.isArray(e)?s[t]=e.map((t=>`<div data-id="${t.id}"></div>`)).join(""):s[t]=`<div data-id="${e.id}"></div>`}));const n=this._createDocumentElement("template");return n.innerHTML=t(s),Object.values(this.children).forEach((t=>{if(Array.isArray(t))t.forEach((t=>{const e=n.content.querySelector(`[data-id="${t.id}"]`);e&&e.replaceWith(t.getContent())}));else{const e=n.content.querySelector(`[data-id="${t.id}"]`);e&&e.replaceWith(t.getContent())}})),n.content}getContent(){return this.element}_makePropsProxy(t){return t=new Proxy(t,{get:(t,e)=>"function"==typeof t[e]?t[e].bind(t):t[e],set:(t,e,s,n)=>{const r=JSON.parse(JSON.stringify(t)),i=Reflect.set(t,e,s,n);return this.eventBus().emit(_.FLOW_CDU,r,t),i}})}_createDocumentElement(t){return document.createElement(t)}show(){this.element&&(this.element.style.display="")}hide(){this.element&&(this.element.style.display="none")}unmount(){this.eventBus().emit(_.FLOW_UM),this._element&&(this._element.outerHTML="")}}function C(t,e,s,n){if(!1===e||null==e||!e&&("class"===t||"style"===t))return"";if(!0===e)return" "+(n?t:t+'="'+t+'"');var r=typeof e;return"object"!==r&&"function"!==r||"function"!=typeof e.toJSON||(e=e.toJSON()),"string"==typeof e||(e=JSON.stringify(e),s||-1===e.indexOf('"'))?(s&&(e=k(e))," "+t+'="'+e+'"'):" "+t+"='"+e.replace(/'/g,"&#39;")+"'"}function x(t,e){return Array.isArray(t)?function(t,e){for(var s,n="",r="",i=Array.isArray(e),a=0;a<t.length;a++)(s=x(t[a]))&&(i&&e[a]&&(s=k(s)),n=n+r+s,r=" ");return n}(t,e):t&&"object"==typeof t?function(t){var e="",s="";for(var n in t)n&&t[n]&&L.call(t,n)&&(e=e+s+n,s=" ");return e}(t):t||""}function k(t){var e=""+t,s=A.exec(e);if(!s)return t;var n,r,i,a="";for(n=s.index,r=0;n<e.length;n++){switch(e.charCodeAt(n)){case 34:i="&quot;";break;case 38:i="&amp;";break;case 60:i="&lt;";break;case 62:i="&gt;";break;default:continue}r!==n&&(a+=e.substring(r,n)),r=n+1,a+=i}return r!==n?a+e.substring(r,n):a}var L=Object.prototype.hasOwnProperty,A=/["&<>]/;function N(t,e){if(1===arguments.length){for(var s=t[0],n=1;n<t.length;n++)s=N(s,t[n]);return s}for(var r in e)if("class"===r){var i=t[r]||[];t[r]=(Array.isArray(i)?i:[i]).concat(e[r]||[])}else if("style"===r){i=(i=E(t[r]))&&";"!==i[i.length-1]?i+";":i;var a=E(e[r]);a=a&&";"!==a[a.length-1]?a+";":a,t[r]=i+a}else t[r]=e[r];return t}function E(t){if(!t)return"";if("object"==typeof t){var e="";for(var s in t)L.call(t,s)&&(e=e+s+":"+t[s]+";");return e}return t+""}var S=function(t){var e,s="",n=t||{};return function(t,n,r,i){s=s+"<label"+C("class",x(["input",n],[!1,!0]),!1,!1)+"><input"+function(t,e){var s="";for(var n in t)if(L.call(t,n)){var r=t[n];if("class"===n){s=C(n,r=x(r),!1,e)+s;continue}"style"===n&&(r=E(r)),s+=C(n,r,!1,e)}return s}(N([{class:"input__el",type:"text"},t]),!1)+"/>",i&&(s=s+'<span class="input__title">'+k(null==(e=i)?"":e)+"</span>"),"password"===t.type&&(s+='<button class="input__eye" type="button"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<g clip-path="url(#clip0_25488_3)">\n<mask id="mask0_25488_3" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="0" y="0" width="16" height="16">\n<path d="M16 0H0V16H16V0Z" fill="white"/>\n</mask>\n<g mask="url(#mask0_25488_3)">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M15.8045 0.195262C16.0648 0.455611 16.0648 0.87772 15.8045 1.13807L12.6591 4.28347C12.6535 4.28933 12.6477 4.29507 12.6419 4.30068L4.28544 12.6571C4.27979 12.663 4.27406 12.6687 4.26825 12.6743L1.13783 15.8047C0.877479 16.0651 0.455367 16.0651 0.195018 15.8047C-0.0653315 15.5444 -0.0653315 15.1223 0.195018 14.8619L2.82265 12.2343C1.94403 11.4271 1.29427 10.5237 0.848559 9.7866C0.578187 9.33947 0.379156 8.94733 0.24683 8.66473C0.180592 8.52333 0.130853 8.40887 0.0970633 8.32813C0.0801626 8.2878 0.067234 8.25587 0.0582096 8.23313L0.0475869 8.20607L0.0444519 8.19793L0.0434254 8.1952L0.043047 8.1942C0.043047 8.1942 0.0427584 8.19347 0.666479 7.95807L0.0492212 7.7062L0.0494901 7.70553L0.0501882 7.7038L0.0522265 7.69887L0.0588771 7.683C0.0644567 7.66973 0.072334 7.65127 0.0825246 7.62793C0.102901 7.58133 0.132555 7.51513 0.171613 7.43227C0.249681 7.26653 0.365615 7.03333 0.520488 6.755C0.829419 6.19987 1.29761 5.45759 1.93511 4.71233C3.2041 3.22885 5.20603 1.66667 7.99978 1.66667C9.63485 1.66667 11.0033 2.20369 12.1097 2.94721L14.8617 0.195262C15.1221 -0.0650874 15.5441 -0.0650874 15.8045 0.195262ZM6.44775 8.6092L8.60892 6.44799C8.42032 6.37391 8.21492 6.33333 7.99978 6.33333C7.07925 6.33333 6.33309 7.07953 6.33309 8C6.33309 8.21513 6.37366 8.42053 6.44775 8.6092ZM9.59685 5.46012C9.13445 5.16888 8.58652 5 7.99978 5C6.3429 5 4.99976 6.34315 4.99976 8C4.99976 8.58673 5.16864 9.13467 5.45987 9.59707L3.76644 11.2905C2.98899 10.5862 2.40091 9.777 1.98951 9.09667C1.74739 8.69627 1.57015 8.3466 1.45432 8.09927C1.43175 8.05107 1.41155 8.00687 1.39369 7.96693C1.46044 7.82693 1.55753 7.6334 1.68557 7.40333C1.96354 6.90387 2.38296 6.23997 2.94832 5.57904C4.08504 4.25018 5.74978 3 7.99978 3C9.21945 3 10.2631 3.36566 11.1455 3.91147L9.59685 5.46012Z" fill="#8D8D8D"/>\n<path d="M0.0492213 7.70621L-0.0495605 7.94887L0.0427585 8.19347L0.666479 7.95807C0.0490057 7.70674 0.0492213 7.70621 0.0492213 7.70621Z" fill="#8D8D8D"/>\n<path d="M13.7379 5.33118C14.0363 5.11554 14.4531 5.18264 14.6687 5.48106C15.0982 6.07542 15.4157 6.62528 15.6267 7.028C15.7323 7.22967 15.8117 7.3954 15.8654 7.51254C15.8923 7.57114 15.9128 7.6176 15.927 7.65047C15.9341 7.66694 15.9396 7.67994 15.9435 7.6894L15.9483 7.7008L15.9498 7.70447L15.9503 7.70574L15.9506 7.70654L15.3332 7.95807L15.9567 8.194L15.9565 8.19467L15.9558 8.19647L15.9539 8.20154L15.9475 8.21774C15.9423 8.23127 15.9348 8.25007 15.9251 8.2738C15.9057 8.32134 15.8775 8.38867 15.8403 8.473C15.7657 8.64154 15.6546 8.87867 15.5051 9.1616C15.2067 9.72594 14.7511 10.4806 14.1213 11.2385C12.8655 12.7495 10.8619 14.3333 7.99987 14.3333C7.41807 14.3333 6.8686 14.2675 6.35157 14.1485C5.99276 14.066 5.7688 13.7082 5.85135 13.3494C5.9339 12.9906 6.2917 12.7666 6.65051 12.8491C7.07034 12.9457 7.51954 13 7.99987 13C10.3166 13 11.9796 11.7295 13.0959 10.3863C13.6521 9.71694 14.0587 9.04447 14.3263 8.53847C14.4497 8.30507 14.5425 8.1088 14.606 7.96694C14.5644 7.87967 14.511 7.77154 14.4455 7.6466C14.2575 7.28774 13.9727 6.79434 13.588 6.262C13.3723 5.96358 13.4395 5.54684 13.7379 5.33118Z" fill="#8D8D8D"/>\n<path d="M15.9565 8.19399C15.9565 8.19399 15.9567 8.19346 15.333 7.95806C15.9505 7.70673 15.9504 7.70653 15.9504 7.70653L16.0491 7.94886L15.9565 8.19399Z" fill="#8D8D8D"/>\n</g>\n</g>\n<defs>\n<clipPath id="clip0_25488_3">\n<rect width="16" height="16" fill="white"/>\n</clipPath>\n</defs>\n</svg>\n</button>'),s=s+'<span class="input__error-text">'+k(null==(e=r)?"":e)+"</span></label>"}.call(this,"attributes"in n?n.attributes:"undefined"!=typeof attributes?attributes:void 0,"className"in n?n.className:"undefined"!=typeof className?className:void 0,"error"in n?n.error:"undefined"!=typeof error?error:void 0,"label"in n?n.label:"undefined"!=typeof label?label:void 0),s};const U={email:"Почта",login:"Логин",first_name:"Имя",second_name:"Фамилия",display_name:"Имя в чате",phone:"Телефон",avatar:"Аватар",password:"Пароль"},O={login:new RegExp(/^(?=.*[A-Z])([A-Za-z0-9-_]{3,20})$/gm),first_name:new RegExp(/^([A-ZА-Я]){1}([A-Za-zА-Яа-я-])+$/gm),second_name:new RegExp(/^([A-ZА-Я]){1}([A-Za-zА-Яа-я-])+$/gm),email:new RegExp(/^\S+@\S+\.\S+$/gi),password:new RegExp(/^(?=.*[0-9])(?=.*[A-Z])([.\S]{8,40})$/g),phone:new RegExp(/^\+?[1-9][0-9]{10,15}$/gi),message:new RegExp(/^.+$/gim)},T={login:"Длина от 3 до 20 символов, первая буква заглавная",first_name:"Поле введено неверно",second_name:"Поле введено неверно",email:"Email введён неверно",password:"Пароль должен быть от 8 до 40 символов",phone:"Телефон введён неверно"};class j extends M{constructor(t){super(t),this.props.attributes.type=t.attributes.type||"text",this.value=this.props.attributes.value||""}validation(){let t=!0;return this.props.attributes.name&&(t=!!`${this.value}`.match(O[this.props.attributes.name]),t?this.props.className&&(this.props.className=this.props.className.replace(" input_error","")):(this.props.className.includes("input_error")||(this.props.className=`${this.props.className||""} input_error`,this.props.error=T[this.props.attributes.name]),t=!1)),t}init(){const t=t=>{t.target&&"INPUT"===t.target.nodeName&&(this.value=t.target.value,this.props.attributes.value=this.value),this.validation()},e=t=>{const e=t.target;if(e&&(e.classList.contains("input__eye")||e.closest(".input__eye"))){const t=this.element.querySelector(".input__el");t.type="password"===t.type?"text":"password"}};this.props.events=this.props.events||{},this.props.events.change?this.props.events.change=Array.isArray(this.props.events.change)?[...this.props.events.change,t]:[this.props.events.change,t]:this.props.events.change=t,this.props.events.click?this.props.events.click=Array.isArray(this.props.events.click)?[...this.props.events.click,e]:[this.props.events.click,e]:this.props.events.click=e}componentUpdated(){if(this.value&&this.element){const t=this.element.querySelector(".input__el");t&&(t.value=this.value)}}render(){return this.compile(S,this.props)}}function D(t,e,s,n){if(!1===e||null==e||!e&&("class"===t||"style"===t))return"";if(!0===e)return" "+(n?t:t+'="'+t+'"');var r=typeof e;return"object"!==r&&"function"!==r||"function"!=typeof e.toJSON||(e=e.toJSON()),"string"==typeof e||(e=JSON.stringify(e),s||-1===e.indexOf('"'))?(s&&(e=I(e))," "+t+'="'+e+'"'):" "+t+"='"+e.replace(/'/g,"&#39;")+"'"}function P(t,e){return Array.isArray(t)?function(t,e){for(var s,n="",r="",i=Array.isArray(e),a=0;a<t.length;a++)(s=P(t[a]))&&(i&&e[a]&&(s=I(s)),n=n+r+s,r=" ");return n}(t,e):t&&"object"==typeof t?function(t){var e="",s="";for(var n in t)n&&t[n]&&F.call(t,n)&&(e=e+s+n,s=" ");return e}(t):t||""}function I(t){var e=""+t,s=z.exec(e);if(!s)return t;var n,r,i,a="";for(n=s.index,r=0;n<e.length;n++){switch(e.charCodeAt(n)){case 34:i="&quot;";break;case 38:i="&amp;";break;case 60:i="&lt;";break;case 62:i="&gt;";break;default:continue}r!==n&&(a+=e.substring(r,n)),r=n+1,a+=i}return r!==n?a+e.substring(r,n):a}var F=Object.prototype.hasOwnProperty,z=/["&<>]/;var B=function(t){var e,s="",n=t||{};return function(t,n,r,i,a,o,c,l){s=s+"<form"+(D("class",P(["form",c?"form_modal":"",r],[!1,!0,!0]),!1,!1)+D("id",a,!0,!1))+">",c&&(s+='<button class="form__close" type="button"></button>'),l&&(s=s+'<p class="form__title">'+I(null==(e=l)?"":e)+"</p>"),s=s+'<div class="auth-form__inputs">'+(null==(e=o)?"":e)+'<div class="auth-form__btns"> '+(null==(e=t)?"":e)+"\n\t"+(null==(e=n)?"":e)+'</div></div><p class="form__error">'+(null==(e=i)?"":e)+"</p></form>"}.call(this,"ActionBtn"in n?n.ActionBtn:"undefined"!=typeof ActionBtn?ActionBtn:void 0,"Link"in n?n.Link:"undefined"!=typeof Link?Link:void 0,"className"in n?n.className:"undefined"!=typeof className?className:void 0,"error"in n?n.error:"undefined"!=typeof error?error:void 0,"id"in n?n.id:"undefined"!=typeof id?id:void 0,"inputs"in n?n.inputs:"undefined"!=typeof inputs?inputs:void 0,"isModal"in n?n.isModal:"undefined"!=typeof isModal?isModal:void 0,"title"in n?n.title:"undefined"!=typeof title?title:void 0),s};var J=class extends M{constructor(t){super(t)}validation(){this.isValid=!0;return(Array.isArray(this.children.inputs)?[...this.children.inputs]:[this.children.inputs]).forEach((t=>{t.validation()||(this.isValid=!1)})),this.isValid}render(){return this.compile(B,this.props)}};function R(t,e,s,n){if(!1===e||null==e||!e&&("class"===t||"style"===t))return"";if(!0===e)return" "+(n?t:t+'="'+t+'"');var r=typeof e;return"object"!==r&&"function"!==r||"function"!=typeof e.toJSON||(e=e.toJSON()),"string"==typeof e||(e=JSON.stringify(e),s||-1===e.indexOf('"'))?(s&&(e=$(e))," "+t+'="'+e+'"'):" "+t+"='"+e.replace(/'/g,"&#39;")+"'"}function Z(t,e){var s="";for(var n in t)if(W.call(t,n)){var r=t[n];if("class"===n){s=R(n,r=H(r),!1,e)+s;continue}"style"===n&&(r=Y(r)),s+=R(n,r,!1,e)}return s}function H(t,e){return Array.isArray(t)?function(t,e){for(var s,n="",r="",i=Array.isArray(e),a=0;a<t.length;a++)(s=H(t[a]))&&(i&&e[a]&&(s=$(s)),n=n+r+s,r=" ");return n}(t,e):t&&"object"==typeof t?function(t){var e="",s="";for(var n in t)n&&t[n]&&W.call(t,n)&&(e=e+s+n,s=" ");return e}(t):t||""}function $(t){var e=""+t,s=q.exec(e);if(!s)return t;var n,r,i,a="";for(n=s.index,r=0;n<e.length;n++){switch(e.charCodeAt(n)){case 34:i="&quot;";break;case 38:i="&amp;";break;case 60:i="&lt;";break;case 62:i="&gt;";break;default:continue}r!==n&&(a+=e.substring(r,n)),r=n+1,a+=i}return r!==n?a+e.substring(r,n):a}var W=Object.prototype.hasOwnProperty,q=/["&<>]/;function V(t,e){if(1===arguments.length){for(var s=t[0],n=1;n<t.length;n++)s=V(s,t[n]);return s}for(var r in e)if("class"===r){var i=t[r]||[];t[r]=(Array.isArray(i)?i:[i]).concat(e[r]||[])}else if("style"===r){i=(i=Y(t[r]))&&";"!==i[i.length-1]?i+";":i;var a=Y(e[r]);a=a&&";"!==a[a.length-1]?a+";":a,t[r]=i+a}else t[r]=e[r];return t}function Y(t){if(!t)return"";if("object"==typeof t){var e="";for(var s in t)W.call(t,s)&&(e=e+s+":"+t[s]+";");return e}return t+""}var G=function(t){var e,s="",n=t||{};return function(t,n,r){s=n?s+"<a"+Z(V([{class:"btn",href:$(n)},t]),!1)+">"+$(null==(e=r)?"":e)+"</a>":s+"<button"+Z(V([{class:"btn"},t]),!1)+">"+$(null==(e=r)?"":e)+"</button>"}.call(this,"attributes"in n?n.attributes:"undefined"!=typeof attributes?attributes:void 0,"href"in n?n.href:"undefined"!=typeof href?href:void 0,"text"in n?n.text:"undefined"!=typeof text?text:void 0),s};var Q=class extends M{constructor(t){super(t)}render(){return this.compile(G,this.props)}};function X(t){const e={};return t.forEach((function(t,s){e[s]=`${t}`.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")})),e}function K(t){return JSON.stringify(t)}var tt=function t(e,s){for(const n in s)if(n in s)try{s[n]?.constructor===Object?s[n]=t(e[n],s[n]):e[n]=s[n]}catch(t){e[n]=s[n]}return e};var et=function(t,e,s){if("object"!=typeof t||null===t)return t;if("string"!=typeof e)throw new Error("path must be string");const n=e.split(".").reduceRight(((t,e)=>({[e]:t})),s);return tt(t,n)};let st;(st||(st={})).Updated="store:updated";const nt=new class extends u{state={};getState(){return this.state}set(t,e){et(this.state,t,e);try{this.emit(st.Updated,t,e)}catch(t){}}};function rt(t,e){let s={};return class extends t{constructor(t){super({...t,...e(nt.getState())}),s={...e(nt.getState())},nt.on(st.Updated,(()=>{this.componentDidUpdate(s,{...e(nt.getState())})&&(s={...e(nt.getState())},this.setProps({...e(nt.getState())}))}))}}}var it=nt;var at=class{isAuthed(){return!!it.getState().user}redirectToIndex(){rs.go(Xe.index)}redirectToLogin(){rs.go(Xe.auth)}getUser(){return it.getState().user}};const ot=new class extends c{signup(t){return this.HTTPEntity.post("/signup",{data:K(t),headers:{"Content-type":"application/json; charset=UTF-8"}})}};const ct=new class extends at{async signup(t){const e=X(t),s=await ot.signup(e);return 200===s.status?(this.getUser(),this.redirectToIndex()):{error:s.response?.reason}}},lt="auth-form__input";var ut=class extends M{init(){this.children={RegistrationForm:new J({title:"Регистрация",inputs:[new j({label:"Почта",className:lt,attributes:{placeholder:"Почта",type:"email",name:"email"}}),new j({label:"Логин",className:lt,attributes:{placeholder:"Логин",name:"login"}}),new j({label:"Имя",className:lt,attributes:{placeholder:"Имя",name:"first_name"}}),new j({label:"Фамилия",className:lt,attributes:{placeholder:"Фамилия",name:"second_name"}}),new j({label:"Телефон",className:lt,attributes:{placeholder:"Телефон",type:"tel",name:"phone"}}),new j({label:"Пароль",className:lt,attributes:{placeholder:"Пароль",type:"password",name:"password"}})],ActionBtn:new Q({text:"Зарегистрироваться",attributes:{type:"submit"}}),Link:`<a class="auth-form__register" href="${Xe.auth}">Войти</a>`,events:{submit:async t=>{t.preventDefault();const e=this.children.RegistrationForm;if(e.validation()){const s=new FormData(t.target),n=await ct.signup(s);e.props.error="",n&&n.error&&(e.props.error=n.error)}}}})}}render(){return this.compile(l,this.props)}componentDidMount(){ct.isAuthed()&&ct.redirectToIndex()}};var pt=function(t){var e,s="",n=t||{};return function(t){s=s+'<div class="auth-page"><div class="auth-page__content"> '+(null==(e=t)?"":e)+"</div></div>"}.call(this,"AuthForm"in n?n.AuthForm:"undefined"!=typeof AuthForm?AuthForm:void 0),s};const dt=new class extends c{signin(t,e){return this.HTTPEntity.post("/signin",{data:K({login:t,password:e}),headers:{"Content-type":"application/json; charset=UTF-8"}})}};var ht=class extends at{async signin(t){const{login:e,password:s}=X(t);if(e&&s){const{status:t,response:n}=await dt.signin(e.toString(),s.toString());if(200!==t)return{error:n?.reason};dt.getUser().then((t=>{it.set("user",{...t}),this.redirectToIndex()}))}}async logout(){const{status:t,response:e}=await dt.logout();if(200!==t)return e?.reason;it.set("user",void 0),rs.go(Xe.auth)}};const ft=new ht,gt="auth-form__input";var vt=class extends M{init(){this.children={AuthForm:new J({title:"Авторизация",inputs:[new j({label:"Логин",className:gt,attributes:{placeholder:"Логин",name:"login"}}),new j({label:"Пароль",className:gt,attributes:{placeholder:"Пароль",type:"password",name:"password"}})],ActionBtn:new Q({text:"Войти",attributes:{type:"submit"}}),Link:`<a class="auth-form__register" href="${Xe.registration}">Зарегистрироваться</a>`,events:{submit:async t=>{t.preventDefault();const e=this.children.AuthForm;if(e.validation()){const s=new FormData(t.target),n=await ft.signin(s);e.props.error="",n&&n.error&&(e.props.error=n.error)}}}})}}render(){return this.compile(pt,this.props)}componentDidMount(){ft.isAuthed()&&ft.redirectToIndex()}};var mt=function(t){var e,s="",n=t||{};return function(t){s=s+'<div><h1>"Ссылки" на страницы</h1><nav><ul></ul>\t'+(null==(e=t)?"":e)+"</nav></div>"}.call(this,"links"in n?n.links:"undefined"!=typeof links?links:void 0),s};const yt="margin-bottom: 2rem;";var bt=class extends M{init(){this.children={links:[new Q({text:"Чаты",href:Xe.index,attributes:{style:yt}}),new Q({text:"Авторизация",href:Xe.auth,attributes:{style:yt}}),new Q({text:"Регистрация",href:Xe.registration,attributes:{style:yt}}),new Q({text:"ЛК: Просмотр данных",href:Xe.profile,attributes:{style:yt}}),new Q({text:"ЛК: Редактирование данных",href:Xe.profileEdit,attributes:{style:yt}}),new Q({text:"ЛК: Редактирование пароля",href:Xe.changePassword,attributes:{style:yt}}),new Q({text:"404",href:Xe.unknown,attributes:{style:yt}}),new Q({text:"500",href:Xe.serverError,attributes:{style:yt}})]}}render(){return this.compile(mt,this.props)}};function _t(t,e,s,n){if(!1===e||null==e||!e&&("class"===t||"style"===t))return"";if(!0===e)return" "+(n?t:t+'="'+t+'"');var r=typeof e;return"object"!==r&&"function"!==r||"function"!=typeof e.toJSON||(e=e.toJSON()),"string"==typeof e||(e=JSON.stringify(e),s||-1===e.indexOf('"'))?(s&&(e=wt(e))," "+t+'="'+e+'"'):" "+t+"='"+e.replace(/'/g,"&#39;")+"'"}function wt(t){var e=""+t,s=Mt.exec(e);if(!s)return t;var n,r,i,a="";for(n=s.index,r=0;n<e.length;n++){switch(e.charCodeAt(n)){case 34:i="&quot;";break;case 38:i="&amp;";break;case 60:i="&lt;";break;case 62:i="&gt;";break;default:continue}r!==n&&(a+=e.substring(r,n)),r=n+1,a+=i}return r!==n?a+e.substring(r,n):a}var Mt=/["&<>]/;var Ct=function(t){var e,s="",n=t||{};return function(t,n,r,i,a,o){s=s+'<div class="profile-page"> <a class="profile-page__back"'+_t("href",n,!0,!1)+'><svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">\n<circle cx="14" cy="14" r="14" transform="rotate(-180 14 14)" fill="#3369F3"/>\n<rect x="20" y="14.8" width="11" height="1.6" transform="rotate(-180 20 14.8)" fill="white"/>\n<path d="M13 19L9 14L13 9" stroke="white" stroke-width="1.6"/>\n</svg>\n</a><div class="profile-page__content">'+(null==(e=t)?"":e)+'<p class="profile-page__name">'+wt(null==(e=o.first_name)?"":e)+'</p><div class="profile-list profile-page__data">',function(){var t=o;if("number"==typeof t.length)for(var n=0,r=t.length;n<r;n++){var i=t[n];"avatar"!==n&&"id"!==n&&(s=s+'<div class="profile-list__el"><p class="profile-list__name">'+wt(null==(e=a[n])?"":e)+"</p>"+(null==(e=i)?"":e)+"</div>")}else{r=0;for(var n in t){r++;i=t[n];"avatar"!==n&&"id"!==n&&(s=s+'<div class="profile-list__el"><p class="profile-list__name">'+wt(null==(e=a[n])?"":e)+"</p>"+(null==(e=i)?"":e)+"</div>")}}}.call(this),s=s+'</div><nav class="profile-list profile-page__links"><div class="profile-list__el"><a'+_t("href",i,!0,!1)+'>Изменить данные</a></div><div class="profile-list__el"><a'+_t("href",r,!0,!1)+'>Изменить пароль</a></div><div class="profile-list__el"><a class="profile-page__exit" id="logout">Выйти</a></div></nav></div></div>'}.call(this,"Photo"in n?n.Photo:"undefined"!=typeof Photo?Photo:void 0,"backUrl"in n?n.backUrl:"undefined"!=typeof backUrl?backUrl:void 0,"changePasswordUrl"in n?n.changePasswordUrl:"undefined"!=typeof changePasswordUrl?changePasswordUrl:void 0,"changeProfileUrl"in n?n.changeProfileUrl:"undefined"!=typeof changeProfileUrl?changeProfileUrl:void 0,"fieldsNaming"in n?n.fieldsNaming:"undefined"!=typeof fieldsNaming?fieldsNaming:void 0,"user"in n?n.user:"undefined"!=typeof user?user:void 0),s};function xt(t,e,s,n){if(!1===e||null==e||!e&&("class"===t||"style"===t))return"";if(!0===e)return" "+(n?t:t+'="'+t+'"');var r=typeof e;return"object"!==r&&"function"!==r||"function"!=typeof e.toJSON||(e=e.toJSON()),"string"==typeof e||(e=JSON.stringify(e),s||-1===e.indexOf('"'))?(s&&(e=Lt(e))," "+t+'="'+e+'"'):" "+t+"='"+e.replace(/'/g,"&#39;")+"'"}function kt(t,e){return Array.isArray(t)?function(t,e){for(var s,n="",r="",i=Array.isArray(e),a=0;a<t.length;a++)(s=kt(t[a]))&&(i&&e[a]&&(s=Lt(s)),n=n+r+s,r=" ");return n}(t,e):t&&"object"==typeof t?function(t){var e="",s="";for(var n in t)n&&t[n]&&At.call(t,n)&&(e=e+s+n,s=" ");return e}(t):t||""}function Lt(t){var e=""+t,s=Nt.exec(e);if(!s)return t;var n,r,i,a="";for(n=s.index,r=0;n<e.length;n++){switch(e.charCodeAt(n)){case 34:i="&quot;";break;case 38:i="&amp;";break;case 60:i="&lt;";break;case 62:i="&gt;";break;default:continue}r!==n&&(a+=e.substring(r,n)),r=n+1,a+=i}return r!==n?a+e.substring(r,n):a}var At=Object.prototype.hasOwnProperty,Nt=/["&<>]/;var Et=function(t){var e,s="",n=t||{};return function(t,n,r,i){s=s+"<div"+xt("class",kt(["photo",r?"photo_change":"",n.class],[!1,!0,!0]),!1,!1)+'><img class="photo__img"'+xt("src",i,!0,!1)+xt("alt",n.alt,!0,!1)+"/>",r&&(s+=null==(e=t)?"":e),s+="</div>"}.call(this,"ChangePhotoModal"in n?n.ChangePhotoModal:"undefined"!=typeof ChangePhotoModal?ChangePhotoModal:void 0,"attributes"in n?n.attributes:"undefined"!=typeof attributes?attributes:void 0,"canChange"in n?n.canChange:"undefined"!=typeof canChange?canChange:void 0,"photoSrc"in n?n.photoSrc:"undefined"!=typeof photoSrc?photoSrc:void 0),s};function St(t,e,s,n){if(!1===e||null==e||!e&&("class"===t||"style"===t))return"";if(!0===e)return" "+(n?t:t+'="'+t+'"');var r=typeof e;return"object"!==r&&"function"!==r||"function"!=typeof e.toJSON||(e=e.toJSON()),"string"==typeof e||(e=JSON.stringify(e),s||-1===e.indexOf('"'))?(s&&(e=Ot(e))," "+t+'="'+e+'"'):" "+t+"='"+e.replace(/'/g,"&#39;")+"'"}function Ut(t,e){return Array.isArray(t)?function(t,e){for(var s,n="",r="",i=Array.isArray(e),a=0;a<t.length;a++)(s=Ut(t[a]))&&(i&&e[a]&&(s=Ot(s)),n=n+r+s,r=" ");return n}(t,e):t&&"object"==typeof t?function(t){var e="",s="";for(var n in t)n&&t[n]&&Tt.call(t,n)&&(e=e+s+n,s=" ");return e}(t):t||""}function Ot(t){var e=""+t,s=jt.exec(e);if(!s)return t;var n,r,i,a="";for(n=s.index,r=0;n<e.length;n++){switch(e.charCodeAt(n)){case 34:i="&quot;";break;case 38:i="&amp;";break;case 60:i="&lt;";break;case 62:i="&gt;";break;default:continue}r!==n&&(a+=e.substring(r,n)),r=n+1,a+=i}return r!==n?a+e.substring(r,n):a}var Tt=Object.prototype.hasOwnProperty,jt=/["&<>]/;var Dt=function(t){var e,s="",n=t||{};return function(t,n,r,i,a,o){s=s+"<form"+(St("class",Ut(["form","from-image",a?"form_modal":"",r.class],[!1,!1,!0,!0]),!1,!1)+St("id",r.id,!0,!1))+' enctype="multipart/form-data">',a&&(s+='<button class="form__close" type="button" data-close="true"></button>'),s=s+'<p class="form__title">'+Ot(null==(e=o)?"":e)+'</p><div class="auth-form__inputs">'+(null==(e=t)?"":e)+"\n"+(null==(e=n)?"":e)+'<span class="form-image__error">'+Ot(null==(e=i)?"":e)+"</span></div></form>"}.call(this,"FileInput"in n?n.FileInput:"undefined"!=typeof FileInput?FileInput:void 0,"SaveBtn"in n?n.SaveBtn:"undefined"!=typeof SaveBtn?SaveBtn:void 0,"attributes"in n?n.attributes:"undefined"!=typeof attributes?attributes:void 0,"errorText"in n?n.errorText:"undefined"!=typeof errorText?errorText:void 0,"isModal"in n?n.isModal:"undefined"!=typeof isModal?isModal:void 0,"title"in n?n.title:"undefined"!=typeof title?title:void 0),s};function Pt(t,e,s,n){if(!1===e||null==e||!e&&("class"===t||"style"===t))return"";if(!0===e)return" "+(n?t:t+'="'+t+'"');var r=typeof e;return"object"!==r&&"function"!==r||"function"!=typeof e.toJSON||(e=e.toJSON()),"string"==typeof e||(e=JSON.stringify(e),s||-1===e.indexOf('"'))?(s&&(e=Ft(e))," "+t+'="'+e+'"'):" "+t+"='"+e.replace(/'/g,"&#39;")+"'"}function It(t,e){return Array.isArray(t)?function(t,e){for(var s,n="",r="",i=Array.isArray(e),a=0;a<t.length;a++)(s=It(t[a]))&&(i&&e[a]&&(s=Ft(s)),n=n+r+s,r=" ");return n}(t,e):t&&"object"==typeof t?function(t){var e="",s="";for(var n in t)n&&t[n]&&zt.call(t,n)&&(e=e+s+n,s=" ");return e}(t):t||""}function Ft(t){var e=""+t,s=Bt.exec(e);if(!s)return t;var n,r,i,a="";for(n=s.index,r=0;n<e.length;n++){switch(e.charCodeAt(n)){case 34:i="&quot;";break;case 38:i="&amp;";break;case 60:i="&lt;";break;case 62:i="&gt;";break;default:continue}r!==n&&(a+=e.substring(r,n)),r=n+1,a+=i}return r!==n?a+e.substring(r,n):a}var zt=Object.prototype.hasOwnProperty,Bt=/["&<>]/;var Jt=function(t){var e,s="",n=t||{};return function(t,n,r,i,a,o){s=s+"<label"+Pt("class",It(["photo-input",n.class],[!1,!0]),!1,!1)+'><input class="photo-input__input" type="file"'+Pt("name",a,!0,!1)+Pt("accept",t,!0,!1)+"/>",s=r?s+'<img class="photo-input__img"'+Pt("src",r,!0,!1)+Pt("alt",a,!0,!1)+'/><span class="photo-input__img-name">'+Ft(null==(e=i)?"":e)+"</span>":s+'<span class="photo-input__title">'+Ft(null==(e=o)?"":e)+"</span>",s+="</label>"}.call(this,"accept"in n?n.accept:"undefined"!=typeof accept?accept:void 0,"attributes"in n?n.attributes:"undefined"!=typeof attributes?attributes:void 0,"currentImg"in n?n.currentImg:"undefined"!=typeof currentImg?currentImg:void 0,"imgName"in n?n.imgName:"undefined"!=typeof imgName?imgName:void 0,"name"in n?n.name:"undefined"!=typeof name?name:void 0,"title"in n?n.title:"undefined"!=typeof title?title:void 0),s};var Rt=class extends M{constructor(t){t.events||(t.events={}),t.events.change=t=>{const e=t.target;if(e&&e.files){const t=e.files[0];if(this.value=t,t.type.startsWith("image")){let e=null;const s=new FileReader;s.onload=s=>{e=s.target?s.target.result:null,this.setProps({imgName:t.name,currentImg:e})},s.readAsDataURL(t)}}},super(t)}componentDidMount(){return!0}componentDidUpdate(){return!0}render(){return this.compile(Jt,this.props)}};var Zt=class extends M{constructor(t){super(t)}init(){this.children={FileInput:new Rt({title:"Выбрать файл на компьютере",accept:this.props.accept||"",name:this.props.name||"avatar",attributes:{class:"form-image__input"}}),SaveBtn:new Q({text:"Поменять",attributes:{class:"form-image__btn"}})}}validation(){return!!this.children.FileInput.value}submit(){}getFile(){return this.children.FileInput.value}render(){return this.compile(Dt,this.props)}};var Ht=class extends M{constructor(t){super(t),this.props.photoSrc?this.props.photoSrc=`https://ya-praktikum.tech/api/v2/resources${this.props.photoSrc}`:this.props.photoSrc="data:image/svg+xml;base64,PCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KDTwhLS0gVXBsb2FkZWQgdG86IFNWRyBSZXBvLCB3d3cuc3ZncmVwby5jb20sIFRyYW5zZm9ybWVkIGJ5OiBTVkcgUmVwbyBNaXhlciBUb29scyAtLT4KPHN2ZyB3aWR0aD0iODAwcHgiIGhlaWdodD0iODAwcHgiIHZpZXdCb3g9Ii0zIDAgMzIgMzIiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgZmlsbD0iIzAwMDAwMCI+Cg08ZyBpZD0iU1ZHUmVwb19iZ0NhcnJpZXIiIHN0cm9rZS13aWR0aD0iMCIvPgoNPGcgaWQ9IlNWR1JlcG9fdHJhY2VyQ2FycmllciIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cg08ZyBpZD0iU1ZHUmVwb19pY29uQ2FycmllciI+IDxnIGlkPSJpY29tb29uLWlnbm9yZSI+IDwvZz4gPHBhdGggZD0iTTEyLjggMy4yYy03LjA5MyAwLTEyLjggNS43MDctMTIuOCAxMi44czUuNzA3IDEyLjggMTIuOCAxMi44YzcuMDkzIDAgMTIuOC01LjcwNyAxMi44LTEyLjhzLTUuNzA3LTEyLjgtMTIuOC0xMi44ek0xMi44IDI3LjczM2MtNi40NTMgMC0xMS43MzMtNS4yOC0xMS43MzMtMTEuNzMzczUuMjgtMTEuNzMzIDExLjczMy0xMS43MzNjNi40NTMgMCAxMS43MzMgNS4yOCAxMS43MzMgMTEuNzMzcy01LjI4IDExLjczMy0xMS43MzMgMTEuNzMzeiIgZmlsbD0iIzMzNjlGMyI+IDwvcGF0aD4gPHBhdGggZD0iTTE5LjQ2NyAxOS4wNDBjLTAuMjY3LTAuMTA3LTAuNTg3LTAuMDUzLTAuNjkzIDAuMjEzLTEuMTczIDIuMjkzLTMuNDY3IDMuNjgtNS45NzMgMy42OC0yLjU2IDAtNC44LTEuMzg3LTUuOTczLTMuNjgtMC4xMDctMC4yNjctMC40MjctMC4zNzMtMC42OTMtMC4yMTMtMC4yNjcgMC4xMDctMC4zNzMgMC40MjctMC4yNjcgMC42OTMgMS4zMzMgMi42MTMgMy45NDcgNC4yNjcgNi45MzMgNC4yNjcgMi45MzMgMCA1LjYtMS42NTMgNi44OC00LjI2NyAwLjE2LTAuMjY3IDAuMDUzLTAuNTg3LTAuMjEzLTAuNjkzeiIgZmlsbD0iIzMzNjlGMyI+IDwvcGF0aD4gPHBhdGggZD0iTTEwLjEzMyAxMy4zMzNjMCAwLjg4NC0wLjcxNiAxLjYtMS42IDEuNnMtMS42LTAuNzE2LTEuNi0xLjZjMC0wLjg4NCAwLjcxNi0xLjYgMS42LTEuNnMxLjYgMC43MTYgMS42IDEuNnoiIGZpbGw9IiMzMzY5RjMiPiA8L3BhdGg+IDxwYXRoIGQ9Ik0xOC42NjcgMTMuMzMzYzAgMC44ODQtMC43MTYgMS42LTEuNiAxLjZzLTEuNi0wLjcxNi0xLjYtMS42YzAtMC44ODQgMC43MTYtMS42IDEuNi0xLjZzMS42IDAuNzE2IDEuNiAxLjZ6IiBmaWxsPSIjMzM2OUYzIj4gPC9wYXRoPiA8L2c+Cg08L3N2Zz4="}init(){this.props.canChange&&(this.children.ChangePhotoModal=new Zt({title:"Изменить аватар",isModal:!0,currentImg:this.props.photoSrc,accept:"image/*",attributes:{class:"",id:""},events:{submit:t=>{t.stopPropagation(),t.preventDefault();const e=this.children.ChangePhotoModal;if(e.props.attributes.class="is-active",e.validation()){const t=new FormData;t.append("avatar",e.getFile()),this.props.formSubmitCallback(t),e.props.errorText="",e.element.classList.toggle("is-active")}else e.props.errorText="Нужно выбрать файл"},click:t=>{t.stopPropagation();const e=t.target;if(e&&e?.classList.contains("form__close")){this.children.ChangePhotoModal.element.classList.toggle("is-active")}}}}),this.props.events||(this.props.events={}),this.props.events.click=()=>{this.children.ChangePhotoModal.element.classList.toggle("is-active")})}render(){return this.compile(Et,this.props)}};var $t=class{constructor(t,e){this.message=t,this.title=e}show(){console.log(this.message)}};var Wt=new class extends c{logout(){return super.logout()}};var qt=new class{async logout(){const{status:t,response:e}=await Wt.logout();200===t?(it.set("user",void 0),setTimeout((()=>{rs.go(Xe.auth)}))):e&&new $t(e.toString()).show()}};var Vt=rt(class extends M{constructor(t){t||(t={}),t.fieldsNaming=U,super(t)}init(){this.props.backUrl=Xe.index,this.props.changeProfileUrl=Xe.profileEdit,this.props.changePasswordUrl=Xe.changePassword,this.children={Photo:new Ht({photoSrc:this.props.user?.avatar||null,attributes:{alt:this.props.user?.first_name||""}})},this.props.events={click:t=>{t.preventDefault();const e=t.target;e&&"logout"===e?.id&&qt.logout()}}}componentDidUpdate(t,e){return!b(t,e)&&(this.children.Photo&&this.props.user?.avatar&&(this.children.Photo.props.photoSrc=`https://ya-praktikum.tech/api/v2/resources${this.props.user?.avatar}`),!0)}render(){return this.compile(Ct,this.props)}},(t=>({user:{...t.user}})));function Yt(t){var e=""+t,s=Gt.exec(e);if(!s)return t;var n,r,i,a="";for(n=s.index,r=0;n<e.length;n++){switch(e.charCodeAt(n)){case 34:i="&quot;";break;case 38:i="&amp;";break;case 60:i="&lt;";break;case 62:i="&gt;";break;default:continue}r!==n&&(a+=e.substring(r,n)),r=n+1,a+=i}return r!==n?a+e.substring(r,n):a}var Gt=/["&<>]/;var Qt=function(t){var e,s="",n=t||{};return function(t,n,r,i){s=s+'<div class="profile-page"> <a class="profile-page__back"'+function(t,e,s,n){if(!1===e||null==e||!e&&("class"===t||"style"===t))return"";if(!0===e)return" "+(n?t:t+'="'+t+'"');var r=typeof e;return"object"!==r&&"function"!==r||"function"!=typeof e.toJSON||(e=e.toJSON()),"string"==typeof e||(e=JSON.stringify(e),s||-1===e.indexOf('"'))?(s&&(e=Yt(e))," "+t+'="'+e+'"'):" "+t+"='"+e.replace(/'/g,"&#39;")+"'"}("href",r,!0,!1)+'><svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">\n<circle cx="14" cy="14" r="14" transform="rotate(-180 14 14)" fill="#3369F3"/>\n<rect x="20" y="14.8" width="11" height="1.6" transform="rotate(-180 20 14.8)" fill="white"/>\n<path d="M13 19L9 14L13 9" stroke="white" stroke-width="1.6"/>\n</svg>\n</a><div class="profile-page__content">'+(null==(e=n)?"":e)+'<p class="profile-page__name">'+Yt(null==(e=i.first_name)?"":e)+"</p>"+(null==(e=t)?"":e)+"</div></div>"}.call(this,"EditForm"in n?n.EditForm:"undefined"!=typeof EditForm?EditForm:void 0,"Photo"in n?n.Photo:"undefined"!=typeof Photo?Photo:void 0,"backUrl"in n?n.backUrl:"undefined"!=typeof backUrl?backUrl:void 0,"user"in n?n.user:"undefined"!=typeof user?user:void 0),s};class Xt extends o{constructor(){super("/user")}}const Kt=new class extends Xt{changeUser(t){return this.HTTPEntity.put("/profile",{data:K(t),headers:{"Content-type":"application/json; charset=UTF-8"}})}changePhoto(t){return this.HTTPEntity.put("/profile/avatar",{data:t})}};var te=class{async changeData(t){const e=X(t),{status:s,response:n}=await Kt.changeUser(e);if(200!==s)return{error:n?.reason};it.set("user",n),rs.go(Xe.profile)}async changeAvatar(t){const{status:e,response:s}=await Kt.changePhoto(t);if(200!==e)return{error:s?.reason};it.set("user",s),rs.go(Xe.profile)}};const ee=new ht,se=new te,ne="auth-form__input";var re=rt(class extends M{constructor(t){t||(t={}),t.fieldsNaming=U,super(t)}init(){this.props.backUrl=Xe.profile,this.children={Photo:new Ht({photoSrc:this.props.user?.avatar||null,canChange:!0,attributes:{alt:this.props.user?.first_name||""},formSubmitCallback:t=>{se.changeAvatar(t)}}),EditForm:new J({inputs:[new j({label:"Почта",className:ne,attributes:{value:this.props.user.email,placeholder:"Почта",type:"email",name:"email"}}),new j({label:"Логин",className:ne,attributes:{value:this.props.user.login,placeholder:"Логин",name:"login"}}),new j({label:"Имя",className:ne,attributes:{value:this.props.user.first_name,placeholder:"Имя",name:"first_name"}}),new j({label:"Имя в чате",className:ne,attributes:{value:this.props.user.display_name,placeholder:"Имя",name:"display_name"}}),new j({label:"Фамилия",className:ne,attributes:{value:this.props.user.second_name,placeholder:"Фамилия",name:"second_name"}}),new j({label:"Телефон",className:ne,attributes:{value:this.props.user.phone,placeholder:"Телефон",type:"tel",name:"phone"}})],ActionBtn:new Q({text:"Изменить",attributes:{type:"submit"}}),Link:"",events:{submit:async t=>{t.preventDefault();const e=this.children.EditForm;if(e.validation()){const s=new FormData(t.target),n=await se.changeData(s);e.props.error="",n&&n.error&&(e.props.error=n.error)}}}}),SaveBtn:new Q({text:"Сохранить",attributes:{class:"profile-page__btn-save",type:"submit"}})}}render(){return this.compile(Qt,this.props)}componentDidMount(){ee.isAuthed()||ee.redirectToLogin()}componentDidUpdate(t,e){return!b(t,e)&&(this.children.Photo&&this.props.user?.avatar&&(this.children.Photo.props.photoSrc=`https://ya-praktikum.tech/api/v2/resources${this.props.user?.avatar}`),!0)}},(t=>({user:{...t.user}})));function ie(t,e,s,n){if(!1===e||null==e||!e&&("class"===t||"style"===t))return"";if(!0===e)return" "+(n?t:t+'="'+t+'"');var r=typeof e;return"object"!==r&&"function"!==r||"function"!=typeof e.toJSON||(e=e.toJSON()),"string"==typeof e||(e=JSON.stringify(e),s||-1===e.indexOf('"'))?(s&&(e=function(t){var e=""+t,s=ae.exec(e);if(!s)return t;var n,r,i,a="";for(n=s.index,r=0;n<e.length;n++){switch(e.charCodeAt(n)){case 34:i="&quot;";break;case 38:i="&amp;";break;case 60:i="&lt;";break;case 62:i="&gt;";break;default:continue}r!==n&&(a+=e.substring(r,n)),r=n+1,a+=i}return r!==n?a+e.substring(r,n):a}(e))," "+t+'="'+e+'"'):" "+t+"='"+e.replace(/'/g,"&#39;")+"'"}var ae=/["&<>]/;var oe=function(t){var e,s="",n=t||{};return function(t,n,r){s=s+'<div class="profile-page"> <a class="profile-page__back"'+ie("href",r,!0,!1)+'><svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">\n<circle cx="14" cy="14" r="14" transform="rotate(-180 14 14)" fill="#3369F3"/>\n<rect x="20" y="14.8" width="11" height="1.6" transform="rotate(-180 20 14.8)" fill="white"/>\n<path d="M13 19L9 14L13 9" stroke="white" stroke-width="1.6"/>\n</svg>\n</a><div class="profile-page__content">'+(null==(e=t)?"":e)+'<form class="profile-list profile-page__data"><div class="profile-list__el"><p class="profile-list__name">Старый пароль</p><input class="profile-list__input" value="" name="oldPassword" type="password" placeholder="Старый пароль"/></div><div class="profile-list__el"><p class="profile-list__name">Новый пароль</p><input class="profile-list__input" value="" name="newPassword" type="password" placeholder="Новый пароль"/></div><div class="profile-list__el"><p class="profile-list__name">Подтверждение пароль</p><input class="profile-list__input" value="" name="confirmPassword" type="password" placeholder="Подтверждение пароля"/></div>'+(null==(e=n)?"":e)+"</form></div></div>"}.call(this,"Photo"in n?n.Photo:"undefined"!=typeof Photo?Photo:void 0,"SaveBtn"in n?n.SaveBtn:"undefined"!=typeof SaveBtn?SaveBtn:void 0,"backUrl"in n?n.backUrl:"undefined"!=typeof backUrl?backUrl:void 0),s};var ce=new class extends o{changePassword(t){return this.HTTPEntity.put("/password",{data:K(t),headers:{"Content-type":"application/json; charset=UTF-8"}})}}("/user");var le=new class{async changePassword(t){const{status:e,response:s}=await ce.changePassword(X(t));200===e?setTimeout((()=>{rs.go(Xe.profile)})):s&&s.reason&&new $t(s.reason.toString()).show()}};const ue=new ht;var pe=rt(class extends M{constructor(t){t&&(t.events={submit:t=>{t.preventDefault();if(this.validate()&&t.target){const e=new FormData(t.target);le.changePassword(e)}}}),super(t)}init(){this.props.backUrl=Xe.profile,this.children={Photo:new Ht({photoSrc:this.props.user?.avatar||null,canChange:!1,attributes:{alt:this.props.user?.first_name||""}}),SaveBtn:new Q({text:"Сохранить",attributes:{class:"profile-page__btn-save",type:"submit"}})}}validate(){let t=!0;this.element.querySelectorAll("input[name]").forEach((e=>{const s=e.type;`${e.value}`.match(O[s])?e.parentElement?.classList.remove("is-error"):(e.parentElement?.classList.add("is-error"),t=!1)}));const e=this.element.querySelector("input[name=newPassword]"),s=this.element.querySelector("input[name=confirmPassword]");return e.value!==s.value&&(e.parentElement?.classList.add("is-error"),s.parentElement?.classList.add("is-error"),t=!1),t}render(){return this.compile(oe,this.props)}componentDidMount(){ue.isAuthed()||ue.redirectToLogin()}},(t=>({user:{...t.user}})));function de(t){var e=""+t,s=he.exec(e);if(!s)return t;var n,r,i,a="";for(n=s.index,r=0;n<e.length;n++){switch(e.charCodeAt(n)){case 34:i="&quot;";break;case 38:i="&amp;";break;case 60:i="&lt;";break;case 62:i="&gt;";break;default:continue}r!==n&&(a+=e.substring(r,n)),r=n+1,a+=i}return r!==n?a+e.substring(r,n):a}var he=/["&<>]/;var fe=function(t){var e,s="",n=t||{};return function(t,n,r,i,a,o){s=s+'<div class="chat-wrapper"><div class="chats-sidebar"><a class="chat-profile"'+function(t,e,s,n){if(!1===e||null==e||!e&&("class"===t||"style"===t))return"";if(!0===e)return" "+(n?t:t+'="'+t+'"');var r=typeof e;return"object"!==r&&"function"!==r||"function"!=typeof e.toJSON||(e=e.toJSON()),"string"==typeof e||(e=JSON.stringify(e),s||-1===e.indexOf('"'))?(s&&(e=de(e))," "+t+'="'+e+'"'):" "+t+"='"+e.replace(/'/g,"&#39;")+"'"}("href",a,!0,!1)+">"+(null==(e=i)?"":e)+'<p class="chat-profile__name">'+de(null==(e=o.display_name||o.first_name)?"":e)+'</p></a><label class="chat-search"><div class="chat-search__icon"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M11.5924 11.4138C10.1605 12.8457 7.83886 12.8457 6.40694 11.4138C4.97502 9.9819 4.97502 7.6603 6.40694 6.22837C7.83886 4.79645 10.1605 4.79645 11.5924 6.22837C13.0243 7.6603 13.0243 9.9819 11.5924 11.4138ZM12.0328 12.7968C10.0725 14.2962 7.25696 14.1495 5.46413 12.3566C3.51151 10.404 3.51151 7.23819 5.46413 5.28556C7.41675 3.33294 10.5826 3.33294 12.5352 5.28556C14.3279 7.07831 14.4747 9.89373 12.9755 11.8539L16.5423 15.4206L15.5994 16.3635L12.0328 12.7968Z" fill="#999999"/>\n</svg>\n</div><input class="chat-search__input" type="text" name="search" placeholder="Поиск"/></label><div class="chat-add" data-modal="add-chat-modal"><div class="chat-add__icon"> <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">\n<circle cx="11" cy="11" r="10.25" stroke="#3369F3" stroke-width="1.5"/>\n<line x1="10.9999" y1="5.5" x2="10.9999" y2="16.5" stroke="#3369F3" stroke-width="1.5"/>\n<line x1="5.49988" y1="11" x2="16.4999" y2="11" stroke="#3369F3" stroke-width="1.5"/>\n</svg>\n</div><span class="chat-add__text">Добавить новый чат</span></div><div class="chats-list"> '+(null==(e=n)?"":e)+"</div></div>",s=(s+=t?null==(e=t)?"":e:'<div class="chat"> <div class="chat-inactive"> <p class="chat-inactive__text">Выберите чат чтобы отправить сообщение</p></div></div>')+(null==(e=r)?"":e)+"</div>"}.call(this,"ActiveChat"in n?n.ActiveChat:"undefined"!=typeof ActiveChat?ActiveChat:void 0,"ChatsList"in n?n.ChatsList:"undefined"!=typeof ChatsList?ChatsList:void 0,"Modals"in n?n.Modals:"undefined"!=typeof Modals?Modals:void 0,"UserPhoto"in n?n.UserPhoto:"undefined"!=typeof UserPhoto?UserPhoto:void 0,"profileUrl"in n?n.profileUrl:"undefined"!=typeof profileUrl?profileUrl:void 0,"user"in n?n.user:"undefined"!=typeof user?user:void 0),s};function ge(t,e,s,n){if(!1===e||null==e||!e&&("class"===t||"style"===t))return"";if(!0===e)return" "+(n?t:t+'="'+t+'"');var r=typeof e;return"object"!==r&&"function"!==r||"function"!=typeof e.toJSON||(e=e.toJSON()),"string"==typeof e||(e=JSON.stringify(e),s||-1===e.indexOf('"'))?(s&&(e=me(e))," "+t+'="'+e+'"'):" "+t+"='"+e.replace(/'/g,"&#39;")+"'"}function ve(t,e){return Array.isArray(t)?function(t,e){for(var s,n="",r="",i=Array.isArray(e),a=0;a<t.length;a++)(s=ve(t[a]))&&(i&&e[a]&&(s=me(s)),n=n+r+s,r=" ");return n}(t,e):t&&"object"==typeof t?function(t){var e="",s="";for(var n in t)n&&t[n]&&ye.call(t,n)&&(e=e+s+n,s=" ");return e}(t):t||""}function me(t){var e=""+t,s=be.exec(e);if(!s)return t;var n,r,i,a="";for(n=s.index,r=0;n<e.length;n++){switch(e.charCodeAt(n)){case 34:i="&quot;";break;case 38:i="&amp;";break;case 60:i="&lt;";break;case 62:i="&gt;";break;default:continue}r!==n&&(a+=e.substring(r,n)),r=n+1,a+=i}return r!==n?a+e.substring(r,n):a}var ye=Object.prototype.hasOwnProperty,be=/["&<>]/;var _e=function(t){var e,s="",n=t||{};return function(t,n,r,i,a,o,c){s=s+"<div"+ge("class",ve(["chat-el",r?"is-active":""],[!1,!0]),!1,!1)+">"+(null==(e=t)?"":e)+'<div class="chat-el__content"> <span class="chat-el__name">'+me(null==(e=c)?"":e),a&&(s=s+"<span"+ge("class",ve(["chat-el__text",i?"chat-el__text_last-user":""],[!1,!0]),!1,!1)+">"+me(null==(e=a.content||"")?"":e)+"</span>"),s+="</span>",a&&(s=s+'<span class="chat-el__time">'+me(null==(e=n)?"":e)+"</span>"),s+="</div>",o>0&&(s=s+'<span class="chat-el__msg-count">'+me(null==(e=o)?"":e)+"</span>"),s+="</div>"}.call(this,"UserPhoto"in n?n.UserPhoto:"undefined"!=typeof UserPhoto?UserPhoto:void 0,"date"in n?n.date:"undefined"!=typeof date?date:void 0,"isActive"in n?n.isActive:"undefined"!=typeof isActive?isActive:void 0,"isUserMessageLast"in n?n.isUserMessageLast:"undefined"!=typeof isUserMessageLast?isUserMessageLast:void 0,"last_message"in n?n.last_message:"undefined"!=typeof last_message?last_message:void 0,"messageCount"in n?n.messageCount:"undefined"!=typeof messageCount?messageCount:void 0,"title"in n?n.title:"undefined"!=typeof title?title:void 0),s};var we=class extends M{constructor(t){if(t.last_message){const e=new Date(`${t.last_message.time}`);t.date=function(t){const e=new Date(t),s=new Date;return e.setHours(0,0,0,0)==s.setHours(0,0,0,0)}(e)?`${e.getHours()}:${e.getMinutes()<10?"0":""}${e.getMinutes()}`:`${e.toLocaleString("ru",{year:"numeric",month:"numeric",day:"numeric"})}`,t.messageCount=Number(t.last_message.unread_message);const s=it.getState().user;s&&s?.id&&(t.isUserMessageLast=s.display_name===t.last_message.user?.display_name)}super(t)}init(){this.children={UserPhoto:new Ht({photoSrc:this.props.avatar,attributes:{class:"chat-el__img",alt:this.props.title}})}}render(){return this.compile(_e,this.props)}};function Me(t){var e=""+t,s=Ce.exec(e);if(!s)return t;var n,r,i,a="";for(n=s.index,r=0;n<e.length;n++){switch(e.charCodeAt(n)){case 34:i="&quot;";break;case 38:i="&amp;";break;case 60:i="&lt;";break;case 62:i="&gt;";break;default:continue}r!==n&&(a+=e.substring(r,n)),r=n+1,a+=i}return r!==n?a+e.substring(r,n):a}var Ce=/["&<>]/;var xe=function(t){var e,s="",n=t||{};return function(t,n,r,i,a,o){s=s+'<div class="chat"><div class="chat-active"> <div class="chat-user"><a class="chat-profile chat-user__profile"'+function(t,e,s,n){if(!1===e||null==e||!e&&("class"===t||"style"===t))return"";if(!0===e)return" "+(n?t:t+'="'+t+'"');var r=typeof e;return"object"!==r&&"function"!==r||"function"!=typeof e.toJSON||(e=e.toJSON()),"string"==typeof e||(e=JSON.stringify(e),s||-1===e.indexOf('"'))?(s&&(e=Me(e))," "+t+'="'+e+'"'):" "+t+"='"+e.replace(/'/g,"&#39;")+"'"}("href",a,!0,!1)+">"+(null==(e=i)?"":e)+'<p class="chat-profile__name">'+Me(null==(e=o)?"":e)+'</p></a><div class="chat-user__menu"> <div class="chat-user__icon"><svg width="3" height="16" viewBox="0 0 3 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<circle cx="1.5" cy="2" r="1.5" fill="#1E1E1E"/>\n<circle cx="1.5" cy="8" r="1.5" fill="#1E1E1E"/>\n<circle cx="1.5" cy="14" r="1.5" fill="#1E1E1E"/>\n</svg>\n</div><div class="chat-user__actions">  <button class="chat-user__action" data-modal="change-photo-modal"><span class="chat-user__action-image"> <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M4 1.5H18C19.3807 1.5 20.5 2.61929 20.5 4V14L14.5194 12.4052C13.5108 12.1362 12.4714 12 11.4275 12H10.5725C9.52864 12 8.48921 12.1362 7.48057 12.4052L1.5 14V4C1.5 2.61929 2.61929 1.5 4 1.5ZM0 4C0 1.79086 1.79086 0 4 0H18C20.2091 0 22 1.79086 22 4V18C22 20.2091 20.2091 22 18 22H4C1.79086 22 0 20.2091 0 18V4ZM8 6C8 7.10457 7.10457 8 6 8C4.89543 8 4 7.10457 4 6C4 4.89543 4.89543 4 6 4C7.10457 4 8 4.89543 8 6Z" fill="#3369F3"/>\n</svg>\n</span><span class="chat-user__action-text">Изменить изображение</span></button><button class="chat-user__action" data-modal="add-user-modal"><span class="chat-user__action-image"> <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">\n<circle cx="11" cy="11" r="10.25" stroke="#3369F3" stroke-width="1.5"/>\n<line x1="10.9999" y1="5.5" x2="10.9999" y2="16.5" stroke="#3369F3" stroke-width="1.5"/>\n<line x1="5.49988" y1="11" x2="16.4999" y2="11" stroke="#3369F3" stroke-width="1.5"/>\n</svg>\n</span><span class="chat-user__action-text">Добавить пользователя</span></button><button class="chat-user__action" data-modal="remove-user-modal"><span class="chat-user__action-image"><svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">\n<circle cx="11" cy="11" r="10.25" stroke="#3369F3" stroke-width="1.5"/>\n<line x1="7.11077" y1="7.11103" x2="14.8889" y2="14.8892" stroke="#3369F3" stroke-width="1.5"/>\n<line x1="7.11078" y1="14.8891" x2="14.889" y2="7.11093" stroke="#3369F3" stroke-width="1.5"/>\n</svg>\n</span><span class="chat-user__action-text">Удалить пользователя</span></button><button class="chat-user__action chat-user__action_remove" data-modal="confirm-modal"><span class="chat-user__action-image"><svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">\n<g clip-path="url(#clip0_25534_5)">\n<path d="M13.8125 7.40625H8.1875V14.9688H13.8125V7.40625Z" stroke="#FF2F2F" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M6.9375 7.40625H15.0625" stroke="#FF2F2F" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M10.0625 6.03125H11.9375" stroke="#FF2F2F" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M10.0625 9.125V12.5625" stroke="#FF2F2F" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M11.9375 9.125V12.5625" stroke="#FF2F2F" stroke-linecap="round" stroke-linejoin="round"/>\n</g>\n<circle cx="11" cy="11" r="10.25" stroke="#FF2F2F" stroke-width="1.5"/>\n<defs>\n<clipPath id="clip0_25534_5">\n<rect width="10" height="11" fill="white" transform="translate(6 5)"/>\n</clipPath>\n</defs>\n</svg>\n</span><span class="chat-user__action-text">Удалить чат</span></button></div></div></div><div class="chat-messages"><div class="chat-messages__row"></div>'+(null==(e=n)?"":e)+'</div><div class="chat-message"><div class="chat-message__menu"> </div>'+(null==(e=t)?"":e)+"</div></div>"+(null==(e=r)?"":e)+"</div>"}.call(this,"MessageFormEl"in n?n.MessageFormEl:"undefined"!=typeof MessageFormEl?MessageFormEl:void 0,"Messages"in n?n.Messages:"undefined"!=typeof Messages?Messages:void 0,"Modals"in n?n.Modals:"undefined"!=typeof Modals?Modals:void 0,"UserPhoto"in n?n.UserPhoto:"undefined"!=typeof UserPhoto?UserPhoto:void 0,"profileUrl"in n?n.profileUrl:"undefined"!=typeof profileUrl?profileUrl:void 0,"title"in n?n.title:"undefined"!=typeof title?title:void 0),s};function ke(t,e,s,n){if(!1===e||null==e||!e&&("class"===t||"style"===t))return"";if(!0===e)return" "+(n?t:t+'="'+t+'"');var r=typeof e;return"object"!==r&&"function"!==r||"function"!=typeof e.toJSON||(e=e.toJSON()),"string"==typeof e||(e=JSON.stringify(e),s||-1===e.indexOf('"'))?(s&&(e=Ae(e))," "+t+'="'+e+'"'):" "+t+"='"+e.replace(/'/g,"&#39;")+"'"}function Le(t,e){return Array.isArray(t)?function(t,e){for(var s,n="",r="",i=Array.isArray(e),a=0;a<t.length;a++)(s=Le(t[a]))&&(i&&e[a]&&(s=Ae(s)),n=n+r+s,r=" ");return n}(t,e):t&&"object"==typeof t?function(t){var e="",s="";for(var n in t)n&&t[n]&&Ne.call(t,n)&&(e=e+s+n,s=" ");return e}(t):t||""}function Ae(t){var e=""+t,s=Ee.exec(e);if(!s)return t;var n,r,i,a="";for(n=s.index,r=0;n<e.length;n++){switch(e.charCodeAt(n)){case 34:i="&quot;";break;case 38:i="&amp;";break;case 60:i="&lt;";break;case 62:i="&gt;";break;default:continue}r!==n&&(a+=e.substring(r,n)),r=n+1,a+=i}return r!==n?a+e.substring(r,n):a}var Ne=Object.prototype.hasOwnProperty,Ee=/["&<>]/;var Se=function(t){var e,s="",n=t||{};return function(t,n,r,i,a){s=n?s+"<div"+ke("class",Le(["chat-messages__message","chat-messages__media",t?"chat-messages__message_in":"chat-messages__message_out"],[!1,!1,!0]),!1,!1)+'><span class="chat-messages__time">'+Ae(null==(e=a)?"":e)+'</span><img class="chat-messages__img"'+ke("src",r,!0,!1)+' alt="Изображение в чате"/></div>':s+'<div class="chat-messages__row"><div'+ke("class",Le(["chat-messages__message",t?"chat-messages__message_in":"chat-messages__message_out"],[!1,!0]),!1,!1)+'><span class="chat-messages__time">'+Ae(null==(e=a)?"":e)+'</span><p class="chat-messages__text">'+Ae(null==(e=i)?"":e)+"</p></div></div>"}.call(this,"isIncoming"in n?n.isIncoming:"undefined"!=typeof isIncoming?isIncoming:void 0,"isMedia"in n?n.isMedia:"undefined"!=typeof isMedia?isMedia:void 0,"src"in n?n.src:"undefined"!=typeof src?src:void 0,"text"in n?n.text:"undefined"!=typeof text?text:void 0,"time"in n?n.time:"undefined"!=typeof time?time:void 0),s};var Ue=class extends M{constructor(t){super(t)}render(){return this.compile(Se,this.props)}};function Oe(t,e,s,n){if(!1===e||null==e||!e&&("class"===t||"style"===t))return"";if(!0===e)return" "+(n?t:t+'="'+t+'"');var r=typeof e;return"object"!==r&&"function"!==r||"function"!=typeof e.toJSON||(e=e.toJSON()),"string"==typeof e||(e=JSON.stringify(e),s||-1===e.indexOf('"'))?(s&&(e=je(e))," "+t+'="'+e+'"'):" "+t+"='"+e.replace(/'/g,"&#39;")+"'"}function Te(t,e){return Array.isArray(t)?function(t,e){for(var s,n="",r="",i=Array.isArray(e),a=0;a<t.length;a++)(s=Te(t[a]))&&(i&&e[a]&&(s=je(s)),n=n+r+s,r=" ");return n}(t,e):t&&"object"==typeof t?function(t){var e="",s="";for(var n in t)n&&t[n]&&De.call(t,n)&&(e=e+s+n,s=" ");return e}(t):t||""}function je(t){var e=""+t,s=Pe.exec(e);if(!s)return t;var n,r,i,a="";for(n=s.index,r=0;n<e.length;n++){switch(e.charCodeAt(n)){case 34:i="&quot;";break;case 38:i="&amp;";break;case 60:i="&lt;";break;case 62:i="&gt;";break;default:continue}r!==n&&(a+=e.substring(r,n)),r=n+1,a+=i}return r!==n?a+e.substring(r,n):a}var De=Object.prototype.hasOwnProperty,Pe=/["&<>]/;var Ie=function(t){var e,s="",n=t||{};return function(t,n,r,i,a,o){s=s+"<form"+(Oe("class",Te(["form","form_modal",n],[!1,!1,!0]),!1,!1)+Oe("id",i,!0,!1))+'><button class="form__close" type="button" data-close="true"></button>',o&&(s=s+'<p class="form__title">'+je(null==(e=o)?"":e)+"</p>"),s=s+(null==(e=a)?"":e)+"\n"+(null==(e=t)?"":e)+"\n"+(null==(e=r)?"":e)+"</form>"}.call(this,"Button"in n?n.Button:"undefined"!=typeof Button?Button:void 0,"className"in n?n.className:"undefined"!=typeof className?className:void 0,"content"in n?n.content:"undefined"!=typeof content?content:void 0,"id"in n?n.id:"undefined"!=typeof id?id:void 0,"input"in n?n.input:"undefined"!=typeof input?input:void 0,"title"in n?n.title:"undefined"!=typeof title?title:void 0),s};var Fe=class extends M{constructor(t){super(t)}getData(t){if(t.preventDefault(),this.children.input&&this.children.input){return new FormData(this.element)}}render(){return this.compile(Ie,this.props)}reset(){this.element.reset()}show(){this.element.classList.add("is-active")}hide(){this.element.classList.remove("is-active")}};var ze=function(t){var e="";return e+='<form class="chat-message-form"><input class="chat-message__input" name="message"/><button class="chat-message__submit" type="submit"><svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">\n<circle cx="14" cy="14" r="14" fill="#3369F3"/>\n<rect x="8" y="13.2" width="11" height="1.6" fill="white"/>\n<path d="M15 9L19 14L15 19" stroke="white" stroke-width="1.6"/>\n</svg>\n</button></form>'};var Be=class extends M{constructor(t){super(t)}submit(){const t=this.element,e=new FormData(t);e.get("message")&&(this.element.dispatchEvent(new CustomEvent("send-message",{detail:e.get("message"),bubbles:!0})),t.reset())}render(){return this.compile(ze,this.props)}};var Je=rt(class extends M{constructor(t){super(t)}init(){const t=new Zt({isModal:!0,title:"Изменить изображение",accept:"image/*",attributes:{id:"change-photo-modal",class:""},events:{change:()=>{t.validation()&&(t.props.attributes.class="is-active",t.props.title="Файл загружен")},submit:()=>{}}}),e=new Zt({isModal:!0,title:"Добавить изображение",name:"file",accept:"image/*,video/*",attributes:{id:"add-photo-modal",class:""},events:{change:()=>{e.validation()&&(e.props.attributes.class="is-active",e.props.title="Файл загружен")},submit:()=>{}}}),s=new Zt({isModal:!0,title:"Добавить файл",attributes:{id:"add-file-modal",class:""},name:"file",events:{change:()=>{s.validation()&&(s.props.attributes.class="is-active",s.props.title="Файл загружен")},submit:()=>{}}}),n=new Fe({title:"Добавить пользователя",id:"add-user-modal",input:new j({label:"Логин",attributes:{type:"text",name:"user-login"}}),Button:new Q({text:"Добавить",attributes:{class:"form-user__btn"}}),events:{submit:t=>{const e=n.getData(t);this.element.dispatchEvent(new CustomEvent("add-user",{detail:e?.get("user-login")})),n.reset(),n.hide()}}}),r=new Fe({title:"Удалить пользователя",id:"remove-user-modal",input:new j({label:"Логин",attributes:{type:"text",name:"user-login"}}),Button:new Q({text:"Удалить",attributes:{class:"form-user__btn btn_cancel"}}),events:{submit:t=>{const e=r.getData(t);this.element.dispatchEvent(new CustomEvent("remove-user",{detail:e?.get("user-login")})),r.reset(),r.hide()}}}),i=new Be({events:{submit:t=>{t.preventDefault(),i.submit()}}}),a=new Fe({title:"Подтвердите действие",id:"confirm-modal",content:'\n    <div class = "form-confirm__btns">\n      <button class = "btn btn_cancel form-confirm__btn">Удалить</button>\n      <button class = "btn form-confirm__btn">Оставить</button>\n    </div>\n    ',events:{click:t=>{t?.preventDefault();const e=t.target;if(e&&e.classList.contains("btn_cancel"))return this.element.dispatchEvent(new Event("remove-chat")),a.hide();e&&e.classList.contains("form-confirm__btn")&&a.hide()}}});this.children={UserPhoto:new Ht({photoSrc:this.props.avatar,attributes:{class:"chat-profile__img",alt:this.props.title}}),Messages:[],Modals:[a,r,n,t,e,s],MessageFormEl:i}}componentDidUpdate(t,e){return(!t.activeChat?.messages||t.activeChat?.messages.length!==e.activeChat?.messages.length)&&(this.fillMessages(),this.element.dispatchEvent(new CustomEvent("updated")),!0)}fillMessages(){if(this.props.activeChat?.messages){this.children.Messages=[];const t=it.getState().user;this.props.activeChat.messages.forEach((e=>{const s=t.id===e.user_id,n=new Date(`${e.time}`),r=new Ue({text:`${e.content}`,time:`${n.getHours()}:${n.getMinutes()<10?"0":""}${n.getMinutes()}`,isIncoming:!s});this.children.Messages.push(r)}))}}render(){return this.compile(xe,this.props)}},(t=>({activeChat:{...t.activeChat}})));var Re=new class extends o{getChats(){return this.HTTPEntity.get("")}addChat(t){return this.HTTPEntity.post("",{data:K(t),headers:{"Content-type":"application/json; charset=UTF-8"}})}removeChat(t){return this.HTTPEntity.delete("",{data:K({chatId:t}),headers:{"Content-type":"application/json; charset=UTF-8"}})}addUser(t,e){return this.HTTPEntity.put("/users",{data:K({chatId:t,users:[e]}),headers:{"Content-type":"application/json; charset=UTF-8"}})}removeUser(t,e){return this.HTTPEntity.delete("/users",{data:K({chatId:t,users:[e]}),headers:{"Content-type":"application/json; charset=UTF-8"}})}getToken(t){return this.HTTPEntity.post(`/token/${t}`)}}("/chats");var Ze=new class extends o{constructor(){super("/user")}searchByLogin(t){return this.HTTPEntity.post("/search",{data:K({login:t}),headers:{"Content-type":"application/json; charset=UTF-8"}})}};var He=class{constructor(t,e){this.token=t,this.chatId=e,this.messageAmount=0}connect(){const t=it.getState().user;return t&&"id"in t?new Promise((e=>{const s=new WebSocket(`wss://ya-praktikum.tech/ws/chats/${t.id}/${this.chatId}/${this.token}`);s.addEventListener("open",(()=>{console.log("Соединение установлено"),this.getOld()})),this.socket=s,this.addEvents(),this.supportConnecting(),e(s)})):null}addEvents(){this.socket&&(this.socket.addEventListener("close",this.onClose.bind(this)),this.socket.addEventListener("message",this.onMessage.bind(this)),this.socket.addEventListener("error",this.onError.bind(this)))}supportConnecting(){setInterval((()=>{this.socket?.send(JSON.stringify({type:"ping"}))}),1e4)}onClose(t){t.wasClean?console.log("Соединение закрыто чисто"):console.log("Обрыв соединения"),console.log(`Код: ${t.code} | Причина: ${t.reason}`)}onMessage(t){const e=JSON.parse(t.data);switch(e?.type){case"message":this.processNewMessage(e);break;case"pong":break;default:this.processOldMessages(e)}}onError(t){console.log("Ошибка",t.message)}getSocket(){return this.socket}sendMessage(t){this.socket&&this.socket.send(JSON.stringify({content:t,type:"message"}))}getOld(){this.socket&&this.socket.send(JSON.stringify({content:`${this.messageAmount}`,type:"get old"}))}processOldMessages(t){if(t?.length){const e=[...it.getState()?.activeChat?.messages||[],...t.reverse()];it.set("activeChat.messages",e),this.messageAmount+=t.length}}processNewMessage(t){const e=[...it.getState()?.activeChat?.messages||[],t];it.set("activeChat.messages",e),this.messageAmount++}};var $e=new class{async updateChats(){const{response:t,status:e}=await Re.getChats();200===e&&it.set("chats",t)}async addChat(t){if(t){const{status:e}=await Re.addChat(X(t));return 200===e}return!1}async removeChat(t){const{status:e}=await Re.removeChat(t);return 200===e}async addUser(t,e){const{status:s,response:n}=await Ze.searchByLogin(e);if(200!==s)return{error:"Ошибка на сервере!"};if(n&&Array.isArray(n)){const e=n.shift().id;if(await Re.addUser(t,e))return{error:""}}return{error:"Пользователь не найден!"}}async removeUser(t,e){const{status:s,response:n}=await Ze.searchByLogin(e);if(200!==s)return{error:"Ошибка на сервере!"};if(n&&Array.isArray(n)){const e=n.shift().id;if(await Re.removeUser(t,e))return{error:""}}return{error:"Пользователь не найден!"}}async connectToChat(t){const{status:e,response:s}=await Re.getToken(t);if(200===e&&s){const e=`${s.token}`;this.activeChat=new He(e,t),this.activeChat.connect()}}sendMessage(t){this.activeChat.sendMessage(t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"))}};const We=new ht;var qe=rt(class extends M{constructor(t){super(t)}async init(){this.props.profileUrl=Xe.profile;const t=new Fe({title:"Добавить чат",id:"add-chat-modal",input:new j({label:"Название чата",attributes:{type:"text",name:"title"}}),Button:new Q({text:"Добавить",attributes:{class:"form-user__btn"}}),events:{submit:async e=>{await $e.addChat(t.getData(e))&&(t.reset(),t.hide(),this.updateChats())}}});this.children={UserPhoto:new Ht({photoSrc:this.props.user.avatar,attributes:{class:"chat-profile__img",alt:this.props.user.first_name}}),ChatsList:[],Modals:[t]},this.props.events||(this.props.events={}),this.props.events.click=[this.openMenu,t=>{let e=t.target;e=e.closest("[data-modal]")||e,document.querySelector(`#${e.dataset.modal}`)?.classList.add("is-active")},t=>{const e=t.target.closest("[data-close]");e&&e.parentElement?.classList.remove("is-active")}]}async updateChats(){await $e.updateChats(),this.children.ChatsList=[];for(const t in this.props.chats){const e=this.props.chats[t];this.children.ChatsList.push(new we({...e,isActive:this.children.ActiveChat?.props.id===e.id,events:{click:this.chooseChat.bind(this,e)}}))}this._render()}async chooseChat(t,e){let s=e.target;s=s.closest(".chat-el")||s,s.classList.contains("is-active")||(this.element.querySelector(".chat-el.is-active")?.classList.remove("is-active"),s.classList.add("is-active"),await $e.connectToChat(Number(t.id)),this.children.ActiveChat=new Je({...t,events:{"remove-chat":async()=>{await $e.removeChat(Number(t.id))&&(delete this.children.ActiveChat,delete this.props.ActiveChat,this.updateChats())},"add-user":async e=>{const s=e.detail,{error:n}=await $e.addUser(Number(t.id),s);if(n)return new $t(n).show()},"remove-user":async e=>{const s=e.detail,{error:n}=await $e.removeUser(Number(t.id),s);if(n)return new $t(n).show()},"send-message":t=>{const e=t.detail;$e.sendMessage(e)},updated:()=>{this.updateChats()}}}),this.props.ActiveChat=this.children.ActiveChat,this.children.ActiveChat.dispatchComponentDidMount())}openMenu(t){let e=t.target;if(e=e.closest(".chat-message__menu")||e.closest(".chat-user__menu")||e,e.classList.length>0){const t=e.querySelector(`.${Array.from(e.classList).join(".")} > [class*=actions]`)||null;t&&t.classList.toggle("is-active")}}render(){return this.compile(fe,this.props)}async componentDidMount(){if(!We.isAuthed())return We.redirectToLogin();this.updateChats()}},(t=>({user:{...t.user},chats:{...t.chats}})));function Ve(t){var e=""+t,s=Ye.exec(e);if(!s)return t;var n,r,i,a="";for(n=s.index,r=0;n<e.length;n++){switch(e.charCodeAt(n)){case 34:i="&quot;";break;case 38:i="&amp;";break;case 60:i="&lt;";break;case 62:i="&gt;";break;default:continue}r!==n&&(a+=e.substring(r,n)),r=n+1,a+=i}return r!==n?a+e.substring(r,n):a}var Ye=/["&<>]/;var Ge=function(t){var e,s="",n=t||{};return function(t,n,r){s=s+'<div class="error-page"> <p class="error-page__status">'+Ve(null==(e=n)?"":e)+'</p><p class="error-page__text">'+Ve(null==(e=r)?"":e)+"</p>"+(null==(e=t)?"":e)+"</div>"}.call(this,"Link"in n?n.Link:"undefined"!=typeof Link?Link:void 0,"status"in n?n.status:"undefined"!=typeof status?status:void 0,"statusText"in n?n.statusText:"undefined"!=typeof statusText?statusText:void 0),s};var Qe=class extends M{constructor(t){super(t)}init(){this.children={Link:new Q({text:"На главную",href:Xe.index,attributes:{class:"error-page__link"}})}}render(){return this.compile(Ge,this.props)}};let Xe;var Ke;(Ke=Xe||(Xe={})).index="/messenger",Ke.unknown="/404",Ke.serverError="/500",Ke.auth="/",Ke.registration="/sign-up",Ke.pagination="/pagination",Ke.profile="/settings",Ke.profileEdit="/settings/edit",Ke.changePassword="/change-password";const ts={"/messenger":qe,"/404":class extends Qe{constructor(){super({status:404,statusText:"Страница ушла, но обещала вернуться"})}},"/500":class extends Qe{constructor(){super({status:500,statusText:"У нас что-то поломалось, уже чиним"})}},"/":vt,"/sign-up":ut,"/pagination":bt,"/settings":Vt,"/settings/edit":re,"/change-password":pe};function es(t,e){const s=document.querySelector(t);s&&(s.appendChild(e.getContent()),e.dispatchComponentDidMount())}var ss=class{constructor(t,e,s){this._pathname=t,this._block=null,this._blockClass=e,this._props=s}navigate(t){this.match(t)&&(this._pathname=t,this.render())}leave(){this._block&&this._block.unmount()}match(t){return e=t,s=this._pathname,e===s;var e,s}render(){this._block||(this._block=new this._blockClass),es("#app",this._block)}};class ns{constructor(t){if(ns.__instance)return ns.__instance;this.routes=[],this.history=window.history,this._currentRoute=null,this._rootQuery=t,ns.__instance=this}use(t,e){const s=new ss(t,e,{rootQuery:this._rootQuery});return this.routes.push(s),this}start(){window.addEventListener("popstate",(t=>{this._onRoute(t.currentTarget?.location.pathname)})),this._onRoute(window.location.pathname)}_onRoute(t){const e=this.getRoute(t)||this.getRoute("/404");this._currentRoute&&this._currentRoute!==e&&this._currentRoute.leave(),e&&(this._currentRoute=e,e.render())}go(t){this.history.pushState({},"",t),this._onRoute(t)}back(){this.history.back()}forward(){this.history.forward()}getRoute(t){return this.routes.find((e=>e.match(t)))}}const rs=new ns("#app"),is=new c;Object.keys(ts).forEach((t=>{rs.use(t,ts[t])})),is.getUser().then((t=>{t&&(it.set("user",t),setInterval((()=>{is.getUser().then((t=>{t?it.set("user",{...t}):(it.set("user",void 0),rs.go(Xe.auth))}))}),5e3)),rs.start()})),document.addEventListener("click",(function(t){let e=t.target;"A"!==e.nodeName&&(e=e.closest("a")||e);const s=e.getAttribute("href");e&&(e.closest("a")||"A"===e.nodeName)&&null!==s&&(t.preventDefault(),rs.go(s))}));
//# sourceMappingURL=index.3025e2e4.js.map
